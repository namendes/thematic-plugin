window.UiExtension=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(2),i=n(5),a=function(){function e(){}return e.register=function(){var e=new URLSearchParams(window.location.search).get("br.parentOrigin"),t=new r;return o.connect(e,t).then(function(e){return new i.Ui(e,t).init()})},e}();t.default=a,t.register=a.register},function(e,t,n){"use strict";const r=new WeakMap,o=new WeakMap,i=Promise.resolve();function a(e){if("string"!=typeof e)throw new TypeError("eventName must be a string")}function c(e){if("function"!=typeof e)throw new TypeError("listener must be a function")}function s(e,t){const n=o.get(e);return n.has(t)||n.set(t,new Set),n.get(t)}class u{constructor(){r.set(this,new Set),o.set(this,new Map)}on(e,t){return a(e),c(t),s(this,e).add(t),this.off.bind(this,e,t)}off(e,t){a(e),c(t),s(this,e).delete(t)}once(e){return new Promise(t=>{a(e);const n=this.on(e,e=>{n(),t(e)})})}async emit(e,t){a(e);const n=s(this,e),o=r.get(this),c=[...n],u=[...o];return await i,Promise.all([...c.map(async e=>{if(n.has(e))return e(t)}),...u.map(async n=>{if(o.has(n))return n(e,t)})])}async emitSerial(e,t){a(e);const n=s(this,e),o=r.get(this),c=[...n],u=[...o];await i;for(const e of c)n.has(e)&&await e(t);for(const n of u)o.has(n)&&await n(e,t)}onAny(e){return c(e),r.get(this).add(e),this.offAny.bind(this,e)}offAny(e){c(e),r.get(this).delete(e)}clearListeners(e){if("string"==typeof e)s(this,e).clear();else{r.get(this).clear();for(const e of o.get(this).values())e.clear()}}listenerCount(e){if("string"==typeof e)return r.get(this).size+s(this,e).size;void 0!==e&&a(e);let t=r.get(this).size;for(const e of o.get(this).values())t+=e.size;return t}}u.Typed=class extends u{},Object.defineProperty(u.Typed,"Typed",{enumerable:!1,value:void 0}),e.exports=u},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),i=n(4),a=function(e){function t(t,n){var r=this.constructor,o=e.call(this,n)||this;return o.code=t,o.message=n,Object.setPrototypeOf(o,r.prototype),o}return r(t,e),t.prototype.toPromise=function(){return Promise.reject(this)},t.fromPenpal=function(e){return new t(t.convertPenpalErrorCode(e),e.message)},t.convertPenpalErrorCode=function(e){switch(e.code){case o.default.ERR_NOT_IN_IFRAME:return i.UiExtensionErrorCode.NotInIframe;case o.default.ERR_CONNECTION_DESTROYED:return i.UiExtensionErrorCode.ConnectionDestroyed;default:return i.UiExtensionErrorCode.InternalError}},t}(Error),c=function(){function e(e){this._parent=e}return e.prototype.call=function(t){if(!this._parent[t])return new a(i.UiExtensionErrorCode.IncompatibleParent,"missing "+t+"()").toPromise();try{return this._parent[t]().catch(e.convertPenpalError)}catch(t){return e.convertPenpalError(t)}},e.convertPenpalError=function(e){return a.fromPenpal(e).toPromise()},e}();t.ParentConnection=c,t.connect=function(e,t){try{return o.default.connectToParent({parentOrigin:e,methods:{emitEvent:t.emit.bind(t)}}).promise.then(function(e){return new c(e)})}catch(e){return a.fromPenpal(e).toPromise()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=t.ERR_CONNECTION_DESTROYED="ConnectionDestroyed",o=t.ERR_CONNECTION_TIMEOUT="ConnectionTimeout",i=t.ERR_NOT_IN_IFRAME="NotInIframe",a={"http:":"80","https:":"443"},c=/^(https?:)?\/\/([^\/:]+)(:(\d+))?/,s={ERR_CONNECTION_DESTROYED:r,ERR_CONNECTION_TIMEOUT:o,ERR_NOT_IN_IFRAME:i,Promise:function(){try{return window?window.Promise:null}catch(e){return null}}(),debug:!1},u=function(){var e=0;return function(){return++e}}(),f=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;s.debug&&(r=console).log.apply(r,["[Penpal]"].concat(t))},l=function(e){var t=[];return e(function(){t.forEach(function(e){e()})}),{then:function(e){t.push(e)}}},d=function(e){return{name:e.name,message:e.message,stack:e.stack}},p=function(e,t,n,o){var i=t.localName,a=t.local,c=t.remote,l=t.remoteOrigin,d=!1;f(i+": Connecting call sender");var p=function(e){return function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];if(f(i+": Sending "+e+"() call"),d){var p=new Error("Unable to send "+e+"() call due to destroyed connection");throw p.code=r,p}return new s.Promise(function(t,r){var o=u();a.addEventListener("message",function n(s){if(s.source===c&&s.origin===l&&"reply"===s.data.penpal&&s.data.id===o){f(i+": Received "+e+"() reply"),a.removeEventListener("message",n);var u=s.data.returnValue;s.data.returnValueIsError&&(u=function(e){var t=new Error;return Object.keys(e).forEach(function(n){return t[n]=e[n]}),t}(u)),("fulfilled"===s.data.resolution?t:r)(u)}}),c.postMessage({penpal:"call",id:o,methodName:e,args:n},l)})}};o.then(function(){d=!0}),n.reduce(function(e,t){return e[t]=p(t),e},e)},h=function(e,t,n){var r=e.localName,o=e.local,i=e.remote,a=e.remoteOrigin,c=!1;f(r+": Connecting call receiver");var u=function(e){if(e.source===i&&e.origin===a&&"call"===e.data.penpal){var n=e.data,o=n.methodName,u=n.args,l=n.id;if(f(r+": Received "+o+"() call"),o in t){var p=function(e){return function(t){if(f(r+": Sending "+o+"() reply"),c)f(r+": Unable to send "+o+"() reply due to destroyed connection");else{var n={penpal:"reply",id:l,resolution:e,returnValue:t};"rejected"===e&&t instanceof Error&&(n.returnValue=d(t),n.returnValueIsError=!0);try{i.postMessage(n,a)}catch(e){throw"DataCloneError"===e.name&&i.postMessage({penpal:"reply",id:l,resolution:"rejected",returnValue:d(e),returnValueIsError:!0},a),e}}}};new s.Promise(function(e){return e(t[o].apply(t,u))}).then(p("fulfilled"),p("rejected"))}}};o.addEventListener("message",u),n.then(function(){c=!0,o.removeEventListener("message",u)})};s.connectToChild=function(e){var t=e.url,n=e.appendTo,i=e.methods,u=void 0===i?{}:i,d=e.timeout,m=void 0,v=new l(function(e){m=e}),y=window,g=document.createElement("iframe");(n||document.body).appendChild(g),v.then(function(){g.parentNode&&g.parentNode.removeChild(g)});var E=g.contentWindow||g.contentDocument.parentWindow,_=function(e){var t=document.location,n=c.exec(e),r=void 0,o=void 0,i=void 0;return n?(r=n[1]?n[1]:t.protocol,o=n[2],i=n[4]):(r=t.protocol,o=t.hostname,i=t.port),r+"//"+o+(i&&i!==a[r]?":"+i:"")}(t);return{promise:new s.Promise(function(e,n){var i=void 0;void 0!==d&&(i=setTimeout(function(){var e=new Error("Connection to child timed out after "+d+"ms");e.code=o,n(e),m()},d));var a={},c=void 0,s=void 0,w=function(t){if(t.source===E&&t.origin===_&&"handshake"===t.data.penpal){f("Parent: Received handshake, sending reply"),t.source.postMessage({penpal:"handshake-reply",methodNames:Object.keys(u)},t.origin);var n={localName:"Parent",local:y,remote:E,remoteOrigin:t.origin};s&&s();var r=new l(function(e){v.then(e),s=e});h(n,u,r),c&&c.forEach(function(e){delete a[e]}),c=t.data.methodNames,p(a,n,c,v),clearTimeout(i),e(a)}};y.addEventListener("message",w),v.then(function(){y.removeEventListener("message",w);var e=new Error("Connection destroyed");e.code=r,n(e)}),f("Parent: Loading iframe"),g.src=t}),iframe:g,destroy:m}},s.connectToParent=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.parentOrigin,n=void 0===t?"*":t,a=e.methods,c=void 0===a?{}:a,u=e.timeout;if(window===window.top){var d=new Error("connectToParent() must be called within an iframe");throw d.code=i,d}var m=void 0,v=new l(function(e){m=e}),y=window,g=y.parent;return{promise:new s.Promise(function(e,t){var i=void 0;void 0!==u&&(i=setTimeout(function(){var e=new Error("Connection to parent timed out after "+u+"ms");e.code=o,t(e),m()},u));var a=function t(r){if(("*"===n||n===r.origin)&&r.source===g&&"handshake-reply"===r.data.penpal){f("Child: Received handshake reply"),y.removeEventListener("message",t);var o={localName:"Child",local:y,remote:g,remoteOrigin:r.origin},a={};h(o,c,v),p(a,o,r.data.methodNames,v),clearTimeout(i),e(a)}};y.addEventListener("message",a),v.then(function(){y.removeEventListener("message",a);var e=new Error("Connection destroyed");e.code=r,t(e)}),f("Child: Sending handshake"),g.postMessage({penpal:"handshake",methodNames:Object.keys(c)},n)}),destroy:m}},t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NotInIframe="NotInIframe",e.IncompatibleParent="IncompatibleParent",e.ConnectionDestroyed="ConnectionDestroyed",e.InternalError="InternalError"}(t.UiExtensionErrorCode||(t.UiExtensionErrorCode={}))},function(e,t,n){"use strict";function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var o=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e){this._parent=e}}(),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.get=function(){return this._parent.call("getPage")},t.prototype.refresh=function(){return this._parent.call("refreshPage")},t}(function(e){function t(t,n,r){var o=e.call(this,t)||this;return o._eventEmitter=n,o._eventScope=r,o}return o(t,e),t.prototype.on=function(e,t){var n=this._eventScope+"."+e;return this._eventEmitter.on(n,t)},t}(i)),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.page=new a(t,n,"channel.page"),r}return o(t,e),t.prototype.refresh=function(){return this._parent.call("refreshChannel")},t}(i),s=function(e){function t(t,n){var r=e.call(this,t)||this;return r.channel=new c(t,n),r}return o(t,e),t.prototype.init=function(){var e=this;return this._parent.call("getProperties").then(function(t){return r(e,t)})},t}(i);t.Ui=s}]);
//# sourceMappingURL=ui-extension.13.0.0.min.js.map